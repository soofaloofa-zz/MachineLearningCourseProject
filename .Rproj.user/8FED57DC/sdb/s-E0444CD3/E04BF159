{
    "contents" : "---\ntitle: \"Prediction of Excercise Type\"\nauthor: \"Kevin Sookocheff\"\ndate: \"March 18, 2015\"\noutput: html_document\n---\n\n## Background\n\nUsing devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible to collect a large amount of data about personal activity relatively inexpensively. These type of devices are part of the quantified self movement â€“ a group of enthusiasts who take measurements about themselves regularly to improve their health, to find patterns in their behavior, or because they are tech geeks. One thing that people regularly do is quantify how much of a particular activity they do, but they rarely quantify how well they do it. In the analysis that follows attempts to predict the manner in which the exercise was performed.\n\n## Pre-Requisites\n\nThe analysis requires a few R packages to be loaded. It is assumed that the required packages have already been installed on the user's system. We also set a random seed to 1234 for reproducibility of this report.\n\n\n```{r, message=FALSE}\nlibrary('caret')\nlibrary('randomForest')\nlibrary('rpart')\nlibrary('dplyr')\nlibrary('ggplot2')\nlibrary('rattle')\nlibrary('doMC')\n\nregisterDoMC(cores=4)\nset.seed(1234)\n```\n\n## Data Preparation\n\nThe training data is available at https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv while the test data is available at https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv.\n\n```{r, cache=TRUE}\ndownload.file(url=\"https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv\",\n              destfile='pml-training.csv',\n              method='curl')\n```\n\nWe can load the data into local variables for further processing. Manual inspection has shown that a few NA values are present and must be accounted for. We also witness that some of the columns are entirely NA values. We can safely remove those columns from our analysis. We also remove any near zero variables and metadata such as username and timestamps, etc.\n\n\n```{r, cache=TRUE}\ntrainingData <- read.csv(\"pml-training.csv\", na.strings=c(\"NA\",\"#DIV/0!\", \"\"))\ntrainingData <- trainingData[,colSums(is.na(trainingData)) == 0]\n# Remove near zero variables.\ntrainingData <- trainingData[, -nearZeroVar(trainingData)]\n# Remove metadata\ntrainingData <- select(trainingData, -(X:num_window))\n```\n\nThe training data for this analysis records 19622 observations of 53 variables.\n\n```{r}\ndim(trainingData)\n```\n\n## Predicting `classe`\n\nGiven this data, we want to predict the `classe` variable for the observations in the `inTest` set. The `classe` variable takes 5 values ranging from A to E.\n\n```{r}\ndistinct(select(trainingData, classe))\n```\n\nWe can plot a bar plot of the values to show the relevant frequency of each class of exercise. The plot shows that classe A is the most frequently occurring and classe D the least frequent. All values do seem likely to occur.\n\n```{r}\nggplot(trainingData, aes(classe)) + geom_bar()\n```\n\n### Cross-Validation\n\nTo actually perform the training we need to partition our data into a training set and a test set. This allows us to do cross-validation before applying our method to the testing set.\n\n\n```{r}\nsample <- createDataPartition(y=trainingData$classe, p=0.60, list=FALSE)\ninTraining <- trainingData[sample,]\ninTest <- trainingData[-sample,]\n```\n\n### Prediction using Decision Trees\n\nOur first prediction will use decision trees. We use the caret package as a clean interface to train our model using rpart.\n\n```{r, cache=TRUE, message=FALSE}\nrPartFit <- train(classe ~ ., data=inTraining, method=\"rpart\")\nrPartPrediction <- predict(rPartFit, inTest)\n```\n\nWe can plot the decision tree made through the rpart method to view the classification method.\n\n```{r}\nfancyRpartPlot(rPartFit$finalModel)\n```\n\n#### Out of sample error\n\nThe confusion matrix shows that our accuracy level is around 50% and our out of sample error is therefore also around 50% (1 - accuracy level).\n\n```{r}\nconfusionMatrix(rPartPrediction, inTest$classe)\n```\n\nWe will try to do better using the random forest algorithm. \n\n### Prediction using Random Forests\n\nOur second prediction will use the random forest algorithm. We again use the caret package.\n\n```{r, cache=TRUE, message=FALSE}\nrfFit <- train(classe ~ ., data=inTraining, method=\"rf\", ntree=100, importance=TRUE)\nrfPrediction <- predict(rfFit, inTest)\n```\n\n#### Out of sample error\n\nThe confusion matrix shows that our accuracy level is 0.99.\n\n```{r}\nconfusionMatrix(rfPrediction, inTest$classe)\n```\n\nThe out of sample error is therefore 1-0.99.\n\n```{r}\n1 - 0.99\n```\n\nThe random forest algorithm clearly performs better than the decision tree algorithm. We will use this algorithm on our test set.\n\n### Predicting the Test Set\n\nWe first pre-process the test data using the same method as the training data.\n\n```{r, cache=TRUE}\ndownload.file(url=\"https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv\",\n              destfile='pml-testing.csv',\n              method='curl')\n```\n\n```{r, cache=TRUE}\ntestingData <- read.csv(\"pml-testing.csv\", na.strings=c(\"NA\",\"#DIV/0!\", \"\"))\ntestingData <- testingData[,colSums(is.na(testingData)) == 0]\n# Remove near zero variables.\ntestingData <- testingData[, -nearZeroVar(testingData)]\n# Remove metadata\ntestingData <- select(testingData, -(X:num_window))\n```\n\nThe testing data for this analysis holds 20 observations of 53 variables.\n\n```{r}\ndim(testingData)\n```\n\nWe can predict the outcome for each of the testing observations using the random forest trained model.\n\n```{r}\nrfTestPrediction <- predict(rfFit, testingData)\nrfTestPrediction\n```\n\n## Final submission\n\nWe use a script to generate submission files for the final submission.\n\n```{r}\n# Write files for submission\npml_write_files = function(x){\n    n = length(x)\n    for(i in 1:n){\n        filename = paste0(\"problem_id_\",i,\".txt\")\n        write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)\n    }\n}\n\npml_write_files(rfTestPrediction)\n```\n",
    "created" : 1426703554131.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3834415621",
    "id" : "E04BF159",
    "lastKnownWriteTime" : 1426791220,
    "path" : "~/Projects/MachineLearningCourseProject/prediction.Rmd",
    "project_path" : "prediction.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}